<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuestionario Proambiental</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <style>
        :root {
            --primary-color: #2e7d32;
            --primary-light: #60ad5e;
            --primary-dark: #005005;
            --secondary-color: #ff9800;
            --text-color: #333;
            --light-bg: #f5f5f5;
            --white: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .card {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 25px;
        }

        .section-title {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-light);
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .radio-group, .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .radio-option, .checkbox-option {
            display: flex;
            align-items: center;
        }

        .radio-option input, .checkbox-option input {
            width: auto;
            margin-right: 8px;
        }

        .likert-scale {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .likert-option {
            text-align: center;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .likert-option:hover {
            background-color: #e9e9e9;
        }

        .likert-option.selected {
            background-color: var(--primary-light);
            color: white;
        }

        .age-distribution {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .age-input {
            display: flex;
            align-items: center;
        }

        .age-input label {
            width: 120px;
            margin-bottom: 0;
        }

        .age-input input {
            width: 80px;
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: #e68900;
        }

        .btn-container {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .chart-container {
            height: 300px;
            margin-bottom: 30px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .stat-card {
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .stat-label {
            color: #666;
        }

        .progress-bar {
            height: 20px;
            background-color: #e0e0e0;
            border-radius: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 10px;
            transition: width 0.5s;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 4px;
            box-shadow: var(--shadow);
            transform: translateX(150%);
            transition: transform 0.3s;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
        }

        @media (max-width: 768px) {
            .age-distribution {
                grid-template-columns: 1fr;
            }
            
            .likert-scale {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div>
                    <h1>Cuestionario de Comportamiento Proambiental</h1>
                    <p>Autosustentabilidad y Desarrollo Comunitario</p>
                </div>
                <div class="logo">ECO-ENCUESTA</div>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="tabs">
            <div class="tab active" data-tab="form">Formulario</div>
            <div class="tab" data-tab="stats">Estadísticas</div>
        </div>

        <div class="tab-content active" id="form-tab">
            <form id="cuestionario-form">
                <div class="card">
                    <h2 class="section-title">Información Demográfica</h2>
                    
                    <div class="form-group">
                        <label for="fecha">Fecha</label>
                        <input type="date" id="fecha" name="fecha" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="hora">Hora</label>
                        <input type="time" id="hora" name="hora" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="edad">Edad</label>
                        <input type="number" id="edad" name="edad" min="1" max="120" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Estado Civil</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" id="soltero" name="estado_civil" value="Soltero" required>
                                <label for="soltero">Soltero</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="casado" name="estado_civil" value="Casado">
                                <label for="casado">Casado</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="divorciado" name="estado_civil" value="Divorciado">
                                <label for="divorciado">Divorciado</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="union_libre" name="estado_civil" value="Unión Libre">
                                <label for="union_libre">Unión Libre</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" id="viudo" name="estado_civil" value="Viudo">
                                <label for="viudo">Viudo</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="num_integrantes_familia">Número de integrantes en la familia</label>
                        <input type="number" id="num_integrantes_familia" name="num_integrantes_familia" min="1" max="20" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Distribución de edades en la familia</label>
                        <div class="age-distribution">
                            <div class="age-input">
                                <label for="edad_0_10">0 - 10 años</label>
                                <input type="number" id="edad_0_10" name="edad_0_10" min="0" max="20" value="0">
                            </div>
                            <div class="age-input">
                                <label for="edad_11_25">11 - 25 años</label>
                                <input type="number" id="edad_11_25" name="edad_11_25" min="0" max="20" value="0">
                            </div>
                            <div class="age-input">
                                <label for="edad_26_50">26 - 50 años</label>
                                <input type="number" id="edad_26_50" name="edad_26_50" min="0" max="20" value="0">
                            </div>
                            <div class="age-input">
                                <label for="edad_51_90">51 - 90 años</label>
                                <input type="number" id="edad_51_90" name="edad_51_90" min="0" max="20" value="0">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="educacion_jefe_hogar">Nivel de educación del jefe del hogar</label>
                        <select id="educacion_jefe_hogar" name="educacion_jefe_hogar" required>
                            <option value="">Seleccione una opción</option>
                            <option value="Primaria">Primaria</option>
                            <option value="Secundaria">Secundaria</option>
                            <option value="Universidad">Universidad</option>
                            <option value="Postgrado">Postgrado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="situacion_laboral_jefe_hogar">Situación laboral del jefe del hogar</label>
                        <select id="situacion_laboral_jefe_hogar" name="situacion_laboral_jefe_hogar" required>
                            <option value="">Seleccione una opción</option>
                            <option value="Desempleado">Desempleado</option>
                            <option value="Trabajo Temporal">Trabajo Temporal</option>
                            <option value="Empleado">Empleado</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="ingreso_mensual_jefe_hogar">Ingreso estimado mensual del jefe del hogar</label>
                        <select id="ingreso_mensual_jefe_hogar" name="ingreso_mensual_jefe_hogar" required>
                            <option value="">Seleccione una opción</option>
                            <option value="Menor al sueldo básico">Menor al sueldo básico</option>
                            <option value="Sueldo básico">Sueldo básico</option>
                            <option value="Mayor al sueldo básico">Mayor al sueldo básico</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="tipo_hogar">Tipo de hogar</label>
                        <select id="tipo_hogar" name="tipo_hogar" required>
                            <option value="">Seleccione una opción</option>
                            <option value="Alquilada">Alquilada</option>
                            <option value="Propia">Propia</option>
                            <option value="Prestada">Prestada</option>
                        </select>
                    </div>
                </div>

                <!-- Secciones de preguntas Likert -->
                <div class="card">
                    <h2 class="section-title">2.2 DETERMINANTES SOCIOCULTURALES O DISPOSICIONALES</h2>
                    <div id="sociocultural-questions">
                        <!-- Las preguntas se generarán dinámicamente con JavaScript -->
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title">2.3 DETERMINANTES AFECTIVOS</h2>
                    <div id="afectivos-questions">
                        <!-- Las preguntas se generarán dinámicamente con JavaScript -->
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title">2.4 DETERMINANTES COGNITIVOS</h2>
                    <div id="cognitivos-questions">
                        <!-- Las preguntas se generarán dinámicamente con JavaScript -->
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title">2.5 SUSTENTABILIDAD AMBIENTAL</h2>
                    <div id="sustentabilidad-ambiental-questions">
                        <!-- Las preguntas se generarán dinámicamente con JavaScript -->
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title">2.6 SUSTENTABILIDAD ECONÓMICA</h2>
                    <div id="sustentabilidad-economica-questions">
                        <!-- Las preguntas se generarán dinámicamente con JavaScript -->
                    </div>
                </div>

                <div class="card">
                    <h2 class="section-title">2.7 DESARROLLO COMUNITARIO</h2>
                    <div id="desarrollo-comunitario-questions">
                        <!-- Las preguntas se generarán dinámicamente con JavaScript -->
                    </div>
                </div>

                <div class="btn-container">
                    <button type="button" id="reset-btn" class="btn btn-secondary">Reiniciar</button>
                    <button type="submit" id="submit-btn" class="btn">Enviar Cuestionario</button>
                </div>
            </form>
        </div>

        <div class="tab-content" id="stats-tab">
            <div class="card">
                <h2 class="section-title">Estadísticas del Cuestionario</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total de Encuestas</div>
                        <div class="stat-value" id="total-surveys">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Edad Promedio</div>
                        <div class="stat-value" id="average-age">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Integrantes Promedio</div>
                        <div class="stat-value" id="average-members">0</div>
                    </div>
                </div>

                <h3 class="section-title">Distribución por Edades</h3>
                <div class="chart-container">
                    <canvas id="age-distribution-chart"></canvas>
                </div>

                <h3 class="section-title">Nivel de Educación</h3>
                <div class="chart-container">
                    <canvas id="education-chart"></canvas>
                </div>

                <h3 class="section-title">Situación Laboral</h3>
                <div class="chart-container">
                    <canvas id="employment-chart"></canvas>
                </div>

                <h3 class="section-title">Ingreso Mensual</h3>
                <div class="chart-container">
                    <canvas id="income-chart"></canvas>
                </div>

                <h3 class="section-title">Tipo de Hogar</h3>
                <div class="chart-container">
                    <canvas id="housing-chart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification">
        ¡Formulario enviado correctamente!
    </div>

    <script>
        // Configuración de Supabase
        const supabaseUrl = 'https://dutapywxsiuxboqsjqvf.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1dGFweXd4c2l1eGJvcXNqcXZmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTM3MTk1MTUsImV4cCI6MjA2OTI5NTUxNX0.SBIDeV_WAWlyLs-ROD1ibXtqqY5bbbh0gouY8gRB9Y4';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Preguntas organizadas por sección
        const questions = {
            sociocultural: [
                "¿Conoce usted qué son los desechos sólidos domiciliarios?",
                "¿Cree usted que existe un comportamiento adecuado en el manejo de los desechos sólidos domiciliarios en la comunidad?",
                "¿Se debe separar los desechos sólidos según su tipo ejemplo: (papel - plástico - orgánico - inorgánico)?",
                "¿Es importante la correcta clasificación de los desechos sólidos orgánicos e inorgánicos en el hogar?",
                "¿Cree que el comportamiento de la comunidad influye en deterioro del medio ambiente?",
                "¿Dedica tiempo para reducir, reutilizar y/o reciclar los desechos sólidos que se generan en el hogar?",
                "¿Los desechos sólidos son un gran problema para la comunidad?"
            ],
            afectivos: [
                "¿Le preocupa el exceso de desechos sólidos domiciliarios?",
                "¿Considera que los desechos sólidos domiciliarios intervienen en las consecuencias climáticas?",
                "¿Le afecta emocionalmente cuando escucha noticias acerca de los desastres naturales?",
                "¿Siente frustración debido a la falta de acciones significativas para abordar la generación de los desechos sólidos?",
                "¿Considera importante pensar en el tipo de planeta que dejaremos a las futuras generaciones?"
            ],
            cognitivos: [
                "¿Es consciente del impacto de los desechos sólidos domiciliarios en el medio ambiente?",
                "¿Investiga frecuentemente acerca de temas medio ambientales?",
                "¿Conoce las consecuencias de la acumulación de los desechos sólidos domiciliarios?",
                "¿Conoce los beneficios de reutilizar un residuo domiciliario?",
                "¿La falta de información es un obstáculo para la correcta gestión de los residuos sólidos domiciliario?"
            ],
            sustentabilidadAmbiental: [
                "¿Los desechos orgánicos generados en el hogar pueden tener otra funcionalidad?",
                "¿La acumulación de desechos afectan a la salud de la población?",
                "¿La reducción, reciclaje y la reutilización de los desechos sólidos puede cuidar al medio ambiente y a la vida silvestre?",
                "¿Cree que la transformación de desechos sólidos en nuevos productos puede contribuir significativamente a la reducción de la generación de desechos?",
                "¿Necesita más información acerca de educación ambiental?"
            ],
            sustentabilidadEconomica: [
                "¿En su hogar practica la separación de los desechos para el reciclaje y le representa algún ingreso?",
                "¿Los desechos sólidos generados en el hogar pueden ser reutilizados para una nueva función o creación de un producto?",
                "¿Cree que el manejo adecuado de los desechos sólidos domiciliarios podría aportar al desarrollo económico comunitario?",
                "¿Los emprendimientos en base a la reutilización de los desechos aporta a su economía?",
                "¿El manejo adecuado de los desechos sólidos domiciliarios ofrece oportunidades para el emprendimiento?"
            ],
            desarrolloComunitario: [
                "¿Es posible reducir la generación de residuos sólidos domiciliarios por medio de eventos de concientización?",
                "¿Participaría en talleres de buenas prácticas y capacitaciones para el correcto manejo de los desechos sólidos domiciliarios?",
                "¿El manejo adecuado de los desechos sólidos domiciliarios puede tener un impacto significativo al medio ambiente?",
                "¿Está dispuesto a participar en un emprendimiento en base al uso de los desechos sólidos?",
                "¿Participaría a una feria de emprendimientos comunitarios en base a desechos domiciliarios reutilizados?"
            ]
        };

        // Opciones de la escala Likert
        const likertOptions = [
            "Totalmente desacuerdo",
            "Desacuerdo",
            "Indiferente",
            "De acuerdo",
            "Totalmente de acuerdo"
        ];

        // Función para generar preguntas Likert
        function generateLikertQuestions(containerId, questionsArray, sectionName) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            questionsArray.forEach((question, index) => {
                const questionId = `${sectionName}_${index}`;
                
                const questionElement = document.createElement('div');
                questionElement.className = 'form-group';
                
                const questionLabel = document.createElement('label');
                questionLabel.textContent = question;
                questionElement.appendChild(questionLabel);
                
                const likertScale = document.createElement('div');
                likertScale.className = 'likert-scale';
                
                likertOptions.forEach((option, optionIndex) => {
                    const optionElement = document.createElement('div');
                    optionElement.className = 'likert-option';
                    optionElement.textContent = option;
                    optionElement.dataset.value = optionIndex + 1;
                    
                    optionElement.addEventListener('click', function() {
                        // Deseleccionar todas las opciones en esta pregunta
                        const allOptions = likertScale.querySelectorAll('.likert-option');
                        allOptions.forEach(opt => opt.classList.remove('selected'));
                        
                        // Seleccionar la opción clickeada
                        this.classList.add('selected');
                        
                        // Actualizar el campo oculto
                        const hiddenInput = document.getElementById(questionId);
                        hiddenInput.value = this.dataset.value;
                    });
                    
                    likertScale.appendChild(optionElement);
                });
                
                questionElement.appendChild(likertScale);
                
                // Campo oculto para almacenar el valor seleccionado
                const hiddenInput = document.createElement('input');
                hiddenInput.type = 'hidden';
                hiddenInput.id = questionId;
                hiddenInput.name = questionId;
                questionElement.appendChild(hiddenInput);
                
                container.appendChild(questionElement);
            });
        }

        // Inicializar todas las preguntas
        document.addEventListener('DOMContentLoaded', function() {
            // Generar preguntas para cada sección
            generateLikertQuestions('sociocultural-questions', questions.sociocultural, 'sociocultural');
            generateLikertQuestions('afectivos-questions', questions.afectivos, 'afectivos');
            generateLikertQuestions('cognitivos-questions', questions.cognitivos, 'cognitivos');
            generateLikertQuestions('sustentabilidad-ambiental-questions', questions.sustentabilidadAmbiental, 'sustentabilidadAmbiental');
            generateLikertQuestions('sustentabilidad-economica-questions', questions.sustentabilidadEconomica, 'sustentabilidadEconomica');
            generateLikertQuestions('desarrollo-comunitario-questions', questions.desarrolloComunitario, 'desarrolloComunitario');
            
            // Configurar pestañas
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.dataset.tab;
                    
                    // Actualizar pestañas activas
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Actualizar contenido activo
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                    
                    // Si es la pestaña de estadísticas, cargar datos
                    if (tabId === 'stats') {
                        loadStatistics();
                    }
                });
            });
            
            // Configurar envío del formulario
            document.getElementById('cuestionario-form').addEventListener('submit', handleFormSubmit);
            
            // Configurar botón de reinicio
            document.getElementById('reset-btn').addEventListener('click', function() {
                document.getElementById('cuestionario-form').reset();
                
                // Limpiar selecciones Likert
                document.querySelectorAll('.likert-option').forEach(option => {
                    option.classList.remove('selected');
                });
            });
            
            // Validar distribución de edades
            document.getElementById('num_integrantes_familia').addEventListener('change', validateAgeDistribution);
            
            // Cargar estadísticas iniciales
            loadStatistics();
        });

        // Validar que la suma de las edades coincida con el número de integrantes
        function validateAgeDistribution() {
            const totalMembers = parseInt(document.getElementById('num_integrantes_familia').value) || 0;
            const age0_10 = parseInt(document.getElementById('edad_0_10').value) || 0;
            const age11_25 = parseInt(document.getElementById('edad_11_25').value) || 0;
            const age26_50 = parseInt(document.getElementById('edad_26_50').value) || 0;
            const age51_90 = parseInt(document.getElementById('edad_51_90').value) || 0;
            
            const sumAges = age0_10 + age11_25 + age26_50 + age51_90;
            
            if (sumAges !== totalMembers) {
                alert(`La suma de las edades (${sumAges}) no coincide con el número de integrantes (${totalMembers}). Por favor, ajuste los valores.`);
            }
        }

        // Manejar el envío del formulario
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            // Validar distribución de edades
            validateAgeDistribution();
            
            // Recopilar datos del formulario
            const formData = new FormData(e.target);
            const data = {};
            
            for (const [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            // Agregar fecha y hora actual si no están especificadas
            if (!data.fecha) {
                const now = new Date();
                data.fecha = now.toISOString().split('T')[0];
            }
            
            if (!data.hora) {
                const now = new Date();
                data.hora = now.toTimeString().split(' ')[0];
            }
            
            try {
                // Insertar datos en Supabase
                const { data: insertedData, error } = await supabase
                    .from('cuestionario_comportamiento_proambiental_autosustentabilidad')
                    .insert([data]);
                
                if (error) {
                    throw error;
                }
                
                // Mostrar notificación de éxito
                showNotification('¡Formulario enviado correctamente!');
                
                // Reiniciar formulario
                e.target.reset();
                
                // Limpiar selecciones Likert
                document.querySelectorAll('.likert-option').forEach(option => {
                    option.classList.remove('selected');
                });
                
                // Recargar estadísticas
                loadStatistics();
                
            } catch (error) {
                console.error('Error al enviar el formulario:', error);
                showNotification('Error al enviar el formulario. Intente nuevamente.', true);
            }
        }

        // Mostrar notificación
        function showNotification(message, isError = false) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            
            if (isError) {
                notification.style.backgroundColor = '#d32f2f';
            } else {
                notification.style.backgroundColor = '#2e7d32';
            }
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Cargar y mostrar estadísticas
        async function loadStatistics() {
            try {
                // Obtener todos los datos de la tabla
                const { data, error } = await supabase
                    .from('cuestionario_comportamiento_proambiental_autosustentabilidad')
                    .select('*');
                
                if (error) {
                    throw error;
                }
                
                if (!data || data.length === 0) {
                    // No hay datos, mostrar valores por defecto
                    updateStatisticsUI({}, 0);
                    return;
                }
                
                // Procesar datos para estadísticas
                const stats = processStatistics(data);
                updateStatisticsUI(stats, data.length);
                
            } catch (error) {
                console.error('Error al cargar estadísticas:', error);
            }
        }

        // Procesar datos para generar estadísticas
        function processStatistics(data) {
            const stats = {
                total: data.length,
                averageAge: 0,
                averageMembers: 0,
                ageDistribution: {
                    '0-10': 0,
                    '11-25': 0,
                    '26-50': 0,
                    '51-90': 0
                },
                education: {
                    'Primaria': 0,
                    'Secundaria': 0,
                    'Universidad': 0,
                    'Postgrado': 0
                },
                employment: {
                    'Desempleado': 0,
                    'Trabajo Temporal': 0,
                    'Empleado': 0
                },
                income: {
                    'Menor al sueldo básico': 0,
                    'Sueldo básico': 0,
                    'Mayor al sueldo básico': 0
                },
                housing: {
                    'Alquilada': 0,
                    'Propia': 0,
                    'Prestada': 0
                }
            };
            
            let totalAge = 0;
            let totalMembers = 0;
            
            data.forEach(item => {
                // Calcular promedios
                totalAge += parseInt(item.edad) || 0;
                totalMembers += parseInt(item.num_integrantes_familia) || 0;
                
                // Distribución por edades
                stats.ageDistribution['0-10'] += parseInt(item.edad_0_10) || 0;
                stats.ageDistribution['11-25'] += parseInt(item.edad_11_25) || 0;
                stats.ageDistribution['26-50'] += parseInt(item.edad_26_50) || 0;
                stats.ageDistribution['51-90'] += parseInt(item.edad_51_90) || 0;
                
                // Educación
                if (item.educacion_jefe_hogar && stats.education[item.educacion_jefe_hogar] !== undefined) {
                    stats.education[item.educacion_jefe_hogar]++;
                }
                
                // Empleo
                if (item.situacion_laboral_jefe_hogar && stats.employment[item.situacion_laboral_jefe_hogar] !== undefined) {
                    stats.employment[item.situacion_laboral_jefe_hogar]++;
                }
                
                // Ingreso
                if (item.ingreso_mensual_jefe_hogar && stats.income[item.ingreso_mensual_jefe_hogar] !== undefined) {
                    stats.income[item.ingreso_mensual_jefe_hogar]++;
                }
                
                // Vivienda
                if (item.tipo_hogar && stats.housing[item.tipo_hogar] !== undefined) {
                    stats.housing[item.tipo_hogar]++;
                }
            });
            
            // Calcular promedios
            stats.averageAge = totalAge / data.length;
            stats.averageMembers = totalMembers / data.length;
            
            return stats;
        }

        // Actualizar la interfaz con las estadísticas
        function updateStatisticsUI(stats, totalSurveys) {
            // Actualizar valores básicos
            document.getElementById('total-surveys').textContent = totalSurveys;
            document.getElementById('average-age').textContent = stats.averageAge ? stats.averageAge.toFixed(1) : '0';
            document.getElementById('average-members').textContent = stats.averageMembers ? stats.averageMembers.toFixed(1) : '0';
            
            // Crear gráficos
            createCharts(stats);
        }

        // Crear gráficos con Chart.js
        function createCharts(stats) {
            // Gráfico de distribución por edades
            const ageCtx = document.getElementById('age-distribution-chart').getContext('2d');
            new Chart(ageCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(stats.ageDistribution || {}),
                    datasets: [{
                        label: 'Distribución por Edades',
                        data: Object.values(stats.ageDistribution || {}),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Gráfico de educación (dona)
            const educationCtx = document.getElementById('education-chart').getContext('2d');
            new Chart(educationCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(stats.education || {}),
                    datasets: [{
                        label: 'Nivel de Educación',
                        data: Object.values(stats.education || {}),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Gráfico de empleo (dona)
            const employmentCtx = document.getElementById('employment-chart').getContext('2d');
            new Chart(employmentCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(stats.employment || {}),
                    datasets: [{
                        label: 'Situación Laboral',
                        data: Object.values(stats.employment || {}),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Gráfico de ingreso (dona)
            const incomeCtx = document.getElementById('income-chart').getContext('2d');
            new Chart(incomeCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(stats.income || {}),
                    datasets: [{
                        label: 'Ingreso Mensual',
                        data: Object.values(stats.income || {}),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
            
            // Gráfico de vivienda (dona)
            const housingCtx = document.getElementById('housing-chart').getContext('2d');
            new Chart(housingCtx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(stats.housing || {}),
                    datasets: [{
                        label: 'Tipo de Hogar',
                        data: Object.values(stats.housing || {}),
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
